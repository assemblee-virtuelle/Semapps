import e,{createElement as t,forwardRef as n}from"react";import{useNotify as o,useLogin as r,Notification as i,useLogout as a,useGetIdentity as c,UserMenu as l,MenuItemLink as m}from"react-admin";import{ThemeProvider as u}from"@material-ui/styles";import{makeStyles as s,createMuiTheme as f}from"@material-ui/core/styles";import{Card as d,Avatar as p,CardActions as h,Button as g}from"@material-ui/core";import w from"@material-ui/icons/Lock";import v from"@material-ui/core/MenuItem";import k from"@material-ui/icons/PowerSettingsNew";import I from"@material-ui/icons/AccountCircle";import y from"@material-ui/icons/Edit";function C(e){this.message=e}C.prototype=new Error,C.prototype.name="InvalidCharacterError";var b="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new C("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o,r=0,i=0,a="";o=t.charAt(i++);~o&&(n=r%4?64*n+o:o,r++%4)?a+=String.fromCharCode(255&n>>(-2*r&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return a};function E(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(b(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return b(t)}}function S(e){this.message=e}S.prototype=new Error,S.prototype.name="InvalidTokenError";var P=function(e){return{login:function(t){return window.location.href="".concat(e,"auth?redirectUrl=")+encodeURIComponent(window.location.href),Promise.resolve()},logout:function(){var t=new URL(window.location.href);return window.location.href="".concat(e,"auth/logout?redirectUrl=")+encodeURIComponent(t.origin+"/#/login?logout"),Promise.resolve("/")},checkAuth:function(){return localStorage.getItem("token"),Promise.resolve()},checkError:function(e){return Promise.resolve()},getPermissions:function(e){return Promise.resolve()},getIdentity:function(){var e=localStorage.getItem("token");if(e){var t=function(e,t){if("string"!=typeof e)throw new S("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(E(e.split(".")[n]))}catch(e){throw new S("Invalid token specified: "+e.message)}}(e),n=t.webId,o=t.name,r=t.familyName;return{id:n,fullName:"".concat(o," ").concat(r)}}}}},U=s((function(e){return{main:{display:"flex",flexDirection:"column",minHeight:"100vh",alignItems:"center",justifyContent:"flex-start",backgroundColor:e.palette.primary[500]},card:{minWidth:300,marginTop:"6em"},lockIconAvatar:{margin:"1em",display:"flex",justifyContent:"center"},lockIcon:{backgroundColor:e.palette.secondary[500]},button:{width:"100%"},icon:{width:24,height:24}}})),N=function(e){var n=e.theme,a=e.history,c=e.location,l=U(),m=o(),s=r(),v=new URLSearchParams(c.search);return v.has("token")&&(localStorage.setItem("token",v.get("token")),m("Vous êtes maintenant connecté","info"),a.push("/")),v.has("logout")&&(localStorage.removeItem("token"),m("Vous êtes maintenant déconnecté","info"),a.push("/")),t(u,{theme:f(n)},t("div",{className:l.main},t(d,{className:l.card},t("div",{className:l.lockIconAvatar},t(p,{className:l.lockIcon},t(w,null))),t(h,null,t(g,{className:l.button,variant:"outlined",type:"submit",onClick:function(){return s()},startIcon:t(p,{src:"/lescommuns.jpg",className:l.icon})},"Les Communs")))),t(i,null))},x=n((function(t,n){var o=a();return e.createElement(v,{onClick:function(){return o()},ref:n},e.createElement(k,null),"   Se déconnecter")})),R=n((function(t,n){var o=t.onClick,r=t.webId;return e.createElement(m,{ref:n,to:"/Person/".concat(encodeURIComponent(r),"/show"),primaryText:"Voir mon profil",leftIcon:e.createElement(I,null),onClick:o})})),A=n((function(t,n){var o=t.onClick,r=t.webId;return e.createElement(m,{ref:n,to:"/Person/".concat(encodeURIComponent(r),"/edit"),primaryText:"Editer mon profil",leftIcon:e.createElement(y,null),onClick:o})})),T=n((function(t,n){var o=t.onClick;return e.createElement(m,{ref:n,to:"/login",primaryText:"Se connecter",onClick:o})})),L=function(t){var n=t.logout,o=t.otherProps,r=c().identity;return e.createElement(l,o,r&&""!==r.id?[e.createElement(R,{webId:r.id,key:"view"}),e.createElement(A,{webId:r.id,key:"edit"}),e.cloneElement(n,{key:"logout"})]:e.createElement(T,null))};export{N as LoginPage,x as LogoutButton,L as UserMenu,P as authProvider};
