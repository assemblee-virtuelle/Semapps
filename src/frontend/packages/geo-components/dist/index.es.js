import e,{useState as t,useMemo as n,useEffect as r,useRef as o,createContext as a,useContext as i,forwardRef as l,useImperativeHandle as u}from"react";import{useResourceDefinition as s,ShowButton as c,EditButton as f,useLocale as p,useTranslate as b,useInput as d,FieldTitle as m,InputHelperText as h,useListContext as g}from"react-admin";import{Typography as y,makeStyles as v,TextField as O,Grid as x,useMediaQuery as j,Box as w,Drawer as E,IconButton as C}from"@material-ui/core";import P from"@material-ui/lab/Autocomplete";import S from"@material-ui/icons/LocationOn";import{useHistory as L,useLocation as I}from"react-router";import z from"@material-ui/core/CircularProgress";import{createPortal as A}from"react-dom";import T,{DomUtil as k,LatLngBounds as N,Map as M,Marker as _,Polyline as D,Popup as R,TileLayer as H}from"leaflet";import"leaflet.markercluster";import B from"@material-ui/icons/Close";var F=function(t){var n=t.record,r=t.basePath,o=s({});return e.createElement(e.Fragment,null,n.label&&e.createElement(y,{variant:"h5"},n.label),n.description&&e.createElement(y,null,n.description.length>150?n.description.substring(0,150)+"...":n.description),o.hasShow&&e.createElement(c,{basePath:r,record:n}),o.hasEdit&&e.createElement(f,{basePath:r,record:n}))},U=function(e,t){var n=e.find((function(e){return e.id.startsWith(t+".")}));if(n)return n.text};function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){W(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return n}(e,t)||Y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){if(e){if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Q(e,t){return e(t={exports:{}},t.exports),t.exports}var ee=Q((function(e){
// @license MIT
!function(t,n){e.exports?e.exports=n():this.Diacritics=n()}(0,(function(){for(var e={map:{}},t=[{base:" ",letters:" "},{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"Th",letters:"Þ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"ff",letters:"ﬀ"},{base:"fi",letters:"ﬁ"},{base:"fl",letters:"ﬂ"},{base:"ffi",letters:"ﬃ"},{base:"ffl",letters:"ﬄ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nñnⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"߀oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oe",letters:"Œœ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"ss",letters:"ß"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"th",letters:"þ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],n=0,r=t.length;n<r;n++)for(var o=t[n].letters.split(""),a=0,i=o.length;a<i;a++)e.map[o[a]]=t[n].base;return e.clean=function(t){if(!t||!t.length||t.length<1)return"";for(var n,r="",o=t.split(""),a=0,i=o.length;a<i;a++)r+=(n=o[a])in e.map?e.map[n]:n;return r},e}))})).clean,te=/[.*+?^${}()|[\]\\]/g,ne=/[a-z0-9_]/i,re=/\s+/;var oe=function(e,t){return e=ee(e),(t=ee(t)).trim().split(re).filter((function(e){return e.length>0})).reduce((function(t,n){var r=n.length,o=ne.test(n[0])?"\\b":"",a=new RegExp(o+n.replace(te,"\\$&"),"i"),i=e.search(a);return i>-1&&(t.push([i,i+r]),e=e.slice(0,i)+new Array(r+1).join(" ")+e.slice(i+r)),t}),[]).sort((function(e,t){return e[0]-t[0]}))},ae=/^\s+|\s+$/g,ie=/^[-+]0x[0-9a-f]+$/i,le=/^0b[01]+$/i,ue=/^0o[0-7]+$/i,se=parseInt,ce="object"==typeof K&&K&&K.Object===Object&&K,fe="object"==typeof self&&self&&self.Object===Object&&self,pe=ce||fe||Function("return this")(),be=Object.prototype.toString,de=Math.max,me=Math.min,he=function(){return pe.Date.now()};function ge(e,t,n){var r,o,a,i,l,u,s=0,c=!1,f=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var n=r,a=o;return r=o=void 0,s=t,i=e.apply(a,n)}function d(e){return s=e,l=setTimeout(h,t),c?b(e):i}function m(e){var n=e-u;return void 0===u||n>=t||n<0||f&&e-s>=a}function h(){var e=he();if(m(e))return g(e);l=setTimeout(h,function(e){var n=t-(e-u);return f?me(n,a-(e-s)):n}(e))}function g(e){return l=void 0,p&&r?b(e):(r=o=void 0,i)}function y(){var e=he(),n=m(e);if(r=arguments,o=this,u=e,n){if(void 0===l)return d(u);if(f)return l=setTimeout(h,t),b(u)}return void 0===l&&(l=setTimeout(h,t)),i}return t=ve(t)||0,ye(n)&&(c=!!n.leading,a=(f="maxWait"in n)?de(ve(n.maxWait)||0,t):a,p="trailing"in n?!!n.trailing:p),y.cancel=function(){void 0!==l&&clearTimeout(l),s=0,r=u=o=l=void 0},y.flush=function(){return void 0===l?i:g(he())},y}function ye(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ve(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==be.call(e)}(e))return NaN;if(ye(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ye(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ae,"");var n=le.test(e);return n||ue.test(e)?se(e.slice(2),n?2:8):ie.test(e)?NaN:+e}var Oe=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ye(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),ge(e,t,{leading:r,maxWait:t,trailing:o})},xe=v((function(e){return{icon:{color:e.palette.text.secondary,marginRight:e.spacing(2)}}})),je=function(e,t){return e.place_name?e.place_name:"string"==typeof t?e[t]:"function"==typeof t?t(e):void 0},we=function(o){var a=o.mapboxConfig,i=(o.record,o.resource),l=o.source,u=o.label,s=(o.basePath,o.parse),c=o.optionText,f=o.helperText,g=q(o,["mapboxConfig","record","resource","source","label","basePath","parse","optionText","helperText"]),v=xe(),j=p(),w=b(),E=G(t(""),2),C=E[0],L=E[1],I=G(t([]),2),z=I[0],A=I[1],T=d({resource:i,source:l}),k=T.input,N=k.value,M=k.onChange,_=k.onBlur,D=k.onFocus,R=T.isRequired,H=T.meta,B=H.error,F=H.submitError,U=H.touched,W=n((function(){return Oe((function(e,t){var n=new URL("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e,".json"));a.language||(a.language=j),Object.entries(a).forEach((function(e){var t=G(e,2),r=t[0],o=t[1];Array.isArray(o)?o=o.join(","):"boolean"==typeof o&&(o=o?"true":"false"),n.searchParams.set(r,o)})),fetch(n.toString()).then((function(e){return e.json()})).then((function(e){return t(e)}))}),200)}),[a,j]);return r((function(){C&&C!==je(N,c)&&W(C,(function(e){return A(e.features)}))}),[N,C,W]),e.createElement(P,{autoComplete:!0,value:N||null,options:N?[N].concat(J(z)):z,filterSelectedOptions:!0,filterOptions:function(e){return e},getOptionLabel:function(e){return je(e,c)},getOptionSelected:function(e,t){return je(e,c)===je(t,c)},onChange:function(e,t){t&&s&&(t=s(t)),M(t),A([])},onInputChange:function(e,t){return L(t)},noOptionsText:w("ra.navigation.no_results"),renderInput:function(t){return t.inputProps.autoComplete="new-password",e.createElement(O,Z({},t,{inputProps:V(V({},t.inputProps),{},{onBlur:function(e){_(e),t.inputProps.onBlur&&t.inputProps.onBlur(e)},onFocus:function(e){D(e),t.inputProps.onFocus&&t.inputProps.onFocus(e)}}),label:""!==u&&!1!==u&&e.createElement(m,{label:u,source:l,resource:i,isRequired:R}),error:!(!U||!B&&!F),helperText:e.createElement(h,{touched:U,error:B||F,helperText:f})},g))},renderOption:function(t){var n=oe(t.text,C),r=function(e,t){var n=[];return 0===t.length?n.push({text:e,highlight:!1}):t[0][0]>0&&n.push({text:e.slice(0,t[0][0]),highlight:!1}),t.forEach((function(r,o){var a=r[0],i=r[1];n.push({text:e.slice(a,i),highlight:!0}),o===t.length-1?i<e.length&&n.push({text:e.slice(i,e.length),highlight:!1}):i<t[o+1][0]&&n.push({text:e.slice(i,t[o+1][0]),highlight:!1})})),n}(t.text,n);return e.createElement(x,{container:!0,alignItems:"center"},e.createElement(x,{item:!0},e.createElement(S,{className:v.icon})),e.createElement(x,{item:!0,xs:!0},"string"==typeof r?r:r.map((function(t,n){return e.createElement("span",{key:n,style:{fontWeight:t.highlight?700:400}},t.text)})),e.createElement(y,{variant:"body2",color:"textSecondary"},t.place_name)))}})};function Ee(e,t){const n=o(t);r((function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t}),[e,t])}we.defaultProps={variant:"filled",margin:"dense"};const Ce=a(null),Pe=Ce.Provider;function Se(){const e=i(Ce);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function Le(t){function n(n,r){const{instance:o,context:a}=t(n).current;return u(r,()=>o),null==n.children?null:e.createElement(Pe,{value:a},n.children)}return l(n)}function Ie(e){function n(n,o){const[a,i]=t(!1),{instance:l}=e(n,i).current;u(o,()=>l),r((function(){a&&l.update()}),[l,a,n.children]);const s=l._contentNode;return s?A(n.children,s):null}return l(n)}function ze(e){function t(t,n){const{instance:r}=e(t).current;return u(n,()=>r),null}return l(t)}function Ae(e){return function(t){const n=Se(),a=e(t,n),{instance:i}=a.current,l=o(t.position),{position:u}=t;return r((function(){return i.addTo(n.map),function(){i.remove()}}),[n.map,i]),r((function(){null!=u&&u!==l.current&&(i.setPosition(u),l.current=u)}),[i,u]),a}}function Te(e,t){const n=o();r((function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}}),[e,t])}function ke(e,t){var n;const r=null!=(n=e.pane)?n:t.pane;return r?{...e,pane:r}:e}function Ne(e,t){return function(n,r){const o=Se(),a=e(ke(n,o),o);return Ee(o.map,n.attribution),Te(a.current,n.eventHandlers),t(a.current,o,n,r),a}}function Me(e){return e.split(" ").filter(Boolean)}function _e(e,t){Me(t).forEach(t=>{k.addClass(e,t)})}function De(e,t){Me(t).forEach(t=>{k.removeClass(e,t)})}function Re(e,t){return null==t?function(t,n){return o(e(t,n))}:function(n,a){const i=o(e(n,a)),l=o(n),{instance:u}=i.current;return r((function(){l.current!==n&&(t(u,n,l.current),l.current=n)}),[u,n,a]),i}}function He(e,t){r((function(){var n;const r=null!=(n=t.layerContainer)?n:t.map;return r.addLayer(e.instance),function(){r.removeLayer(e.instance)}}),[t,e])}function Be(e){return function(t){const n=Se(),r=e(ke(t,n),n);return Ee(n.map,t.attribution),Te(r.current,t.eventHandlers),He(r.current,n),r}}function Fe(e,t){const n=o();r((function(){if(t.pathOptions!==n.current){var r;const o=null!=(r=t.pathOptions)?r:{};e.instance.setStyle(o),n.current=o}}),[e,t])}function Ue(e){return function(t){const n=Se(),r=e(ke(t,n),n);return Te(r.current,t.eventHandlers),He(r.current,n),Fe(r.current,t),r}}function We(e,t){return Le(Be(Re(e,t)))}function Ze(e,t){return Ie(Ne(Re(e),t))}function $e(e,t){return Le(Ue(Re(e,t)))}function Ve(e,t){return ze(Be(Re(e,t)))}function qe(e,t,n){const{opacity:r,zIndex:o}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=o&&o!==n.zIndex&&e.setZIndex(o)}var Ge=Object.freeze({__proto__:null,useAttribution:Ee,updateCircle:function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)},createContainerComponent:Le,createDivOverlayComponent:Ie,createLeafComponent:ze,CONTEXT_VERSION:1,LeafletContext:Ce,LeafletProvider:Pe,useLeafletContext:Se,createControlHook:Ae,createDivOverlayHook:Ne,addClassName:_e,removeClassName:De,updateClassName:function(e,t,n){null!=e&&n!==t&&(null!=t&&t.length>0&&De(e,t),null!=n&&n.length>0&&_e(e,n))},createElementHook:Re,useEventHandlers:Te,createControlComponent:function(e){return ze(Ae(Re((function(t,n){return{instance:e(t),context:n}}))))},createLayerComponent:We,createOverlayComponent:Ze,createPathComponent:$e,createTileLayerComponent:Ve,updateGridLayer:qe,createLayerHook:Be,useLayerLifecycle:He,updateMediaOverlay:function(e,t,n){t.bounds instanceof N&&t.bounds!==n.bounds&&e.setBounds(t.bounds),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=t.zIndex&&t.zIndex!==n.zIndex&&e.setZIndex(t.zIndex)},withPane:ke,createPathHook:Ue,usePathOptions:Fe});function Je(e){const t=Se().map;return r((function(){return t.on(e),function(){t.off(e)}}),[t,e]),t}function Ye(){return(Ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Xe({children:a,className:i,id:l,placeholder:u,style:s,whenCreated:c,...f}){const p=o(null),b=function(e,n){const[o,a]=t(null);return r(()=>{if(null!==e.current&&null===o){const t=new M(e.current,n);null!=n.center&&null!=n.zoom?t.setView(n.center,n.zoom):null!=n.bounds&&t.fitBounds(n.bounds,n.boundsOptions),null!=n.whenReady&&t.whenReady(n.whenReady),a(t)}},[e,o,n]),o}(p,f),d=o(!1);r(()=>{null!=b&&!1===d.current&&null!=c&&(d.current=!0,c(b))},[b,c]);const[m]=t({className:i,id:l,style:s}),h=n(()=>b?{__version:1,map:b}:null,[b]),g=h?e.createElement(Pe,{value:h},a):null!=u?u:null;return e.createElement("div",Ye({},m,{ref:p}),g)}const Ke=We((function({position:e,...t},n){const r=new _(e,t);return{instance:r,context:{...n,overlayContainer:r}}}),(function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())})),Qe=$e((function({positions:e,...t},n){const r=new D(e,t);return{instance:r,context:{...n,overlayContainer:r}}}),(function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)})),et=Ze((function(e,t){return{instance:new R(e,t.overlayContainer),context:t}}),(function(e,t,n,o){const{onClose:a,onOpen:i,position:l}=n;r((function(){const{instance:n}=e;function r(e){e.popup===n&&(n.update(),o(!0),null==i||i())}function u(e){e.popup===n&&(o(!1),null==a||a())}return t.map.on({popupopen:r,popupclose:u}),null==t.overlayContainer?(null!=l&&n.setLatLng(l),n.openOn(t.map)):t.overlayContainer.bindPopup(n),function(){t.map.off({popupopen:r,popupclose:u}),null==t.overlayContainer?t.map.removeLayer(n):t.overlayContainer.unbindPopup()}}),[e,t,o,a,i,l])})),tt=Ve((function({url:e,...t},n){return{instance:new H(e,ke(t,n)),context:n}}),qe);var nt,rt=Q((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,r=(n=T)&&n.__esModule?n:{default:n};function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=(0,Ge.createPathComponent)((function(e,t){e.children;var n=s(e,["children"]),o={},i={};Object.entries(n).forEach((function(e){var t=l(e,2),n=t[0],r=t[1];return n.startsWith("on")?i[n]=r:o[n]=r}));var u=new r.default.markerClusterGroup(o);return Object.entries(i).forEach((function(e){var t=l(e,2),n=t[0],r=t[1],o="cluster".concat(n.substring(2).toLowerCase());u.on(o,r)})),{instance:u,context:a(a({},t),{},{layerContainer:u})}}));t.default=c})),ot=(nt=rt)&&nt.__esModule&&Object.prototype.hasOwnProperty.call(nt,"default")?nt.default:nt,at=function(){var e=L(),t=new URLSearchParams(e.location.search);return Je({moveend:function(n){t.set("lat",n.target.getCenter().lat),t.set("lng",n.target.getCenter().lng),e.replace({pathname:e.location.pathname,search:"?"+t.toString()})},zoomend:function(n){t.set("zoom",n.target.getZoom()),e.replace({pathname:e.location.pathname,search:"?"+t.toString()})}}),null},it=v((function(){return{loading:{zIndex:1e3,position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},closeButton:{position:"absolute",zIndex:1400,top:0,right:0}}})),lt=function(n){var r,o=n.latitude,a=n.longitude,i=n.label,l=n.description,u=n.popupContent,s=n.height,c=n.center,f=n.zoom,p=n.groupClusters,b=n.boundToMarkers,d=n.connectMarkers,m=q(n,["latitude","longitude","label","description","popupContent","height","center","zoom","groupClusters","boundToMarkers","connectMarkers"]),h=g(),y=h.ids,v=h.data,O=h.basePath,x=h.loading,P=j((function(e){return e.breakpoints.down("xs")}),{noSsr:!0}),S=G(t(null),2),L=S[0],A=S[1],T=G(t(null),2),k=T[0],N=T[1],M=it(),_=new URLSearchParams(I().search);c=_.has("lat")&&_.has("lng")?[_.get("lat"),_.get("lng")]:c,f=_.has("zoom")?_.get("zoom"):f;var D=y.map((function(e){return V(V({},v[e]),{},{latitude:o&&o(v[e]),longitude:a&&a(v[e]),label:i&&i(v[e]),description:l&&l(v[e])})})).filter((function(e){return e.latitude&&e.longitude})),R=b&&D.length>0?D.map((function(e){return[e.latitude,e.longitude]})):void 0;if(b&&!R)return null;var H=D.map((function(t,n){var o=e.createElement(e.Fragment,{key:n},e.createElement(Ke,{position:[t.latitude,t.longitude],eventHandlers:P?{click:function(){k.setView([t.latitude,t.longitude]),A(t)}}:void 0},!P&&e.createElement(et,null,e.createElement(u,{record:t,basePath:O}))),d&&r&&e.createElement(Qe,{positions:[[r.latitude,r.longitude],[t.latitude,t.longitude]]}));return r=t,o}));return e.createElement(Xe,Z({style:{height:s},center:b?void 0:c,zoom:b?void 0:f,bounds:R,whenCreated:N},m),e.createElement(tt,{attribution:'© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),x&&e.createElement(w,{alignItems:"center",className:M.loading},e.createElement(z,{size:60,thickness:6})),p?e.createElement(ot,{showCoverageOnHover:!1},H):H,e.createElement(at,null),e.createElement(E,{anchor:"bottom",open:!!L,onClose:function(){return A(null)}},e.createElement(w,{p:1,position:"relative"},e.createElement(C,{onClick:function(){return A(null)},className:M.closeButton},e.createElement(B,null)),L&&e.createElement(u,{record:L,basePath:O}))))};lt.defaultProps={height:700,center:[47,2.213749],zoom:6,groupClusters:!0,connectMarkers:!1,scrollWheelZoom:!1,popupContent:F};var ut=v((function(e){return{address:{marginTop:e.spacing(2),marginBottom:e.spacing(1)}}})),st=function(t){var n=t.record,r=t.latitude,o=t.longitude,a=t.address,i=t.height,l=t.addLabel,u=q(t,["record","latitude","longitude","address","height","addLabel"]),s=ut(),c=[r(n),o(n)];return c[0]&&c[1]?e.createElement(w,{addLabel:l},a&&e.createElement(y,{className:s.address},a(n)),e.createElement(Xe,Z({style:{height:i},center:c},u),e.createElement(tt,{attribution:'© <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.createElement(Ke,{position:c}))):null};st.defaultProps={height:400,zoom:11,addLabel:!0};export{F as DefaultPopupContent,we as LocationInput,st as MapField,lt as MapList,at as QueryStringUpdater,U as extractContext};
//# sourceMappingURL=index.es.js.map
