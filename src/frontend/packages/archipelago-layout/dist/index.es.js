import e,{useEffect as t,createElement as r,cloneElement as n,Children as a,useState as o}from"react";import{getResources as l,Notification as i,TopToolbar as c,ListButton as s,Create as u,ShowButton as m,Edit as d,CreateButton as p,ExportButton as f,RefreshButton as h,List as E,Pagination as b,SimpleList as g,useListContext as v,linkToRecord as y,ImageField as P,EditButton as w,Show as x,sanitizeListRestProps as k,Link as L,useCreate as S,useTranslate as N,useNotify as C,ReferenceInput as I,Button as B,FormWithRedirect as T,TextInput as O,required as R,SaveButton as W}from"react-admin";import{Grid as F,Button as j,TextField as A,Select as U,MenuItem as V,makeStyles as M,Box as H,Container as z,Hidden as G,useMediaQuery as _,ThemeProvider as D,createMuiTheme as q,Tabs as $,Tab as J,Typography as K,CircularProgress as Q,LinearProgress as X,Dialog as Y,DialogTitle as Z,DialogContent as ee,DialogActions as te}from"@material-ui/core";import{useHistory as re,useLocation as ne,Link as ae}from"react-router-dom";import{Form as oe,Field as le,useForm as ie}from"react-final-form";import{useSelector as ce,shallowEqual as se}from"react-redux";import{useHistory as ue,useLocation as me}from"react-router";import{createMuiTheme as de,ThemeProvider as pe,makeStyles as fe}from"@material-ui/core/styles";import he from"react-markdown";import Ee from"classnames";import be from"@material-ui/icons/Add";import ge from"@material-ui/icons/Cancel";function ve(e,t,r,n,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function ye(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pe(){return(Pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function we(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var l,i=e[Symbol.iterator]();!(n=(l=i.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ke(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ke(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Le=function(t){var r=t.input,n=we(t,["input"]);return e.createElement(A,Pe({},r,n))},Se=function(t){var r=t.input,n=we(t,["input"]),a=ce(l,se);return e.createElement(U,Pe({},r,n),a.filter((function(e){return e.hasList})).map((function(t){return e.createElement(V,{value:t.name,key:t.name},t.options.label)})))},Ne=function(){var t=re(),r=ne().pathname.match(/^\/([^/]+)/),n=r?r[1]:"Organization";return e.createElement(oe,{onSubmit:function(e){var r=e.filter,n=e.type;r?t.push("/".concat(n,"?filter=").concat(encodeURIComponent('{"q": "'.concat(r,'"}')))):t.push("/".concat(n))},initialValues:{type:n},render:function(t){var r=t.handleSubmit;return e.createElement("form",{onSubmit:r},e.createElement(F,{container:!0,spacing:2},e.createElement(F,{item:!0,xs:5},e.createElement(le,{name:"filter",component:Le,placeholder:"Rechercher...",fullWidth:!0})),e.createElement(F,{item:!0,xs:5},e.createElement(le,{name:"type",component:Se,fullWidth:!0})),e.createElement(F,{item:!0,xs:2},e.createElement(j,{variant:"outlined",type:"submit",fullWidth:!0},"Hop"))))}})},Ce=M((function(e){return{header:{position:"relative",height:65},logo:ye({position:"absolute",top:-15,height:110,width:110},e.breakpoints.down("xs"),{position:"relative",top:0,width:65,height:65})}})),Ie=function(t){var r=t.userMenu,n=t.logout,a=Ce();return e.createElement(H,{bgcolor:"primary.main"},e.createElement(z,{maxWidth:"lg",className:a.header},e.createElement(F,{container:!0},e.createElement(F,{item:!0,xs:12,sm:r?3:6},e.createElement(ae,{to:"/"},e.createElement("img",{src:process.env.PUBLIC_URL+"/logo192.png",alt:"SemApps",className:a.logo}))),e.createElement(G,{xsDown:!0},e.createElement(F,{item:!0,sm:6},e.createElement(H,{pt:2},e.createElement(Ne,null)))),r&&e.createElement(F,{item:!0,sm:3,align:"right"},e.createElement(H,{pt:2},e.cloneElement(r,{logout:n}))))))},Be=function(){var e=ne().pathname;return t((function(){window.scrollTo(0,0)}),[e]),null},Te=function(t){var r=t.appBar,n=t.logout,a=t.theme,o=t.children,l=_(a.breakpoints.down("xs"));return e.createElement(D,{theme:a},e.createElement(Be,null),e.cloneElement(r,{logout:n}),e.createElement(z,{maxWidth:"lg",disableGutters:l},e.createElement(H,{mb:{xs:0,sm:5}},o)),e.createElement(i,null))};Te.defaultProps={appBar:e.createElement(Ie,null)};var Oe=q(),Re=q({palette:{primary:{main:"#28ccfb"},secondary:{main:"#bcef5b"},grey:{main:"#e0e0e0"}},typography:{details:{fontSize:8}},overrides:{RaChipField:{chip:{marginLeft:0,marginTop:0,marginRight:8,marginBottom:8}},RaShow:{card:ye({padding:25},Oe.breakpoints.down("xs"),{padding:15})},RaList:{content:ye({padding:25},Oe.breakpoints.down("xs"),{padding:15})},RaListToolbar:{toolbar:ye({},Oe.breakpoints.down("xs"),{height:0,minHeight:0})},RaSingleFieldList:{root:{marginTop:0,marginBottom:0}},MuiTab:{labelIcon:{paddingTop:0}}}}),We=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=we(t,["basePath","className","data","hasList"]);return e.createElement(c,Pe({className:n},l),o&&e.createElement(s,{basePath:r,record:a}))},Fe=function(t){return e.createElement(u,Pe({actions:e.createElement(We,null),redirect:"show"},t))},je=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasShow,i=we(t,["basePath","className","data","hasList","hasShow"]);return e.createElement(c,Pe({className:n},i),o&&e.createElement(s,{basePath:r,record:a}),l&&e.createElement(m,{basePath:r,record:a}))},Ae=function(t){return e.createElement(d,Pe({actions:e.createElement(je,null)},t))},Ue=M((function(e){return{tab:{minWidth:55}}})),Ve=function(){var t=ue(),r=Ue(),n=me().pathname.match(/^\/([^/]+)/),a=n?n[1]:null,o=ce(l,se),i=_((function(e){return e.breakpoints.down("xs")}));return e.createElement($,{value:a,onChange:function(e,r){return t.push("/"+r)},indicatorColor:"primary",textColor:"primary",scrollButtons:"auto"},o.filter((function(e){return e.hasList})).map((function(t){return e.createElement(J,{key:t.name,icon:e.createElement(t.icon),label:i?void 0:t.options.label,value:t.name,className:r.tab})})))},Me=function(t){var r=t.bulkActions,n=t.basePath,a=t.currentSort,o=t.displayedFilters,i=t.exporter,s=t.filters,u=t.filterValues,m=t.onUnselectItems,d=t.resource,E=t.selectedIds,b=t.showFilter,g=t.total,v=_((function(e){return e.breakpoints.down("xs")})),y=ce(l,se).filter((function(e){return e.name==d}))[0];return e.createElement(c,null,r&&e.cloneElement(r,{basePath:n,filterValues:u,resource:d,selectedIds:E,onUnselectItems:m}),s&&e.cloneElement(s,{resource:d,showFilter:b,displayedFilters:o,filterValues:u,context:"button"}),y.hasCreate&&e.createElement(p,{basePath:n}),!v&&e.createElement(f,{disabled:0===g,resource:d,sort:a,filter:u,exporter:i}),!v&&e.createElement(h,null))},He=function(t){return e.createElement(b,Pe({rowsPerPageOptions:[25,50,100]},t))},ze=function(t){var r=t.children,n=we(t,["children"]);return e.createElement(E,Pe({actions:e.createElement(Me,null),sort:{field:"pair:label",order:"DESC"},pagination:e.createElement(He,null),perPage:50},n),e.createElement(e.Fragment,null,e.createElement(Ve,null),r))},Ge=de({overrides:{MuiListItem:{root:{padding:15,paddingBottom:15,paddingTop:15,marginBottom:10,borderStyle:"solid",borderColor:"#e0e0e0",borderWidth:1}}}}),_e=function(t){return e.createElement(pe,{theme:Ge},e.createElement(g,t))},De=M((function(){return{rightLabel:{color:"grey",textAlign:"right",borderBottom:"1px dashed #c0c0c0",paddingBottom:10,marginBottom:10}}})),qe=function(t){var r=t.label,n=t.children,a=t.record,o=t.resource,l=t.source,i=t.basePath,c=De();return a[l]?e.createElement(H,{mb:4},e.createElement(H,{className:c.rightLabel},r),e.createElement(H,{m:0},e.cloneElement(n,{record:a,resource:o,basePath:i}))):null},$e=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.showLabel,i=we(t,["basePath","children","record","resource","showLabel"]);return e.createElement(F,Pe({item:!0},i),e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel&&l?e.createElement(qe,{record:a,resource:o,basePath:r,label:t.props.label,source:t.props.source,disabled:!1},t):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},Je=M((function(){return{root:{flexGrow:1}}})),Ke=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=Je();return e.createElement("div",{className:l.root},e.createElement(F,{container:!0,spacing:5},e.Children.map(n,(function(t){return t&&e.isValidElement(t)?e.cloneElement(t,{resource:o,record:a,basePath:r}):null}))))},Qe=function(e){return e.stopPropagation()},Xe=function(){},Ye=function(e){var t=e.children,o=e.xs,l=e.linkType,i=v(),c=i.ids,s=i.data,u=i.basePath;return r(F,{container:!0,spacing:3},c.map((function(e){return r(F,{item:!0,xs:o,key:e},r(ae,{to:y(u,e,l),onClick:Qe},n(a.only(t),{record:s[e],basePath:u,onClick:Xe})))})))};Ye.defaultProps={xs:6,linkType:"edit"};var Ze=M((function(){return{line:{borderBottom:"1px solid #e0e0e0",marginTop:-6,marginBottom:7}}})),et=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=Ze();return e.createElement(H,null,e.Children.map(n,(function(t){return t&&a[t.props.source]&&e.isValidElement(t)?e.createElement("div",{key:t.props.source},t.props.addLabel?e.createElement(F,{container:!0,spacing:3,className:l.line},e.createElement(F,{item:!0,xs:3},e.createElement(K,{color:"textSecondary",align:"right",variant:"body2"},t.props.label)),e.createElement(F,{item:!0,xs:9},e.createElement(K,{variant:"body2"},e.cloneElement(t,{record:a,resource:o,basePath:r})))):"string"==typeof t.type?t:e.cloneElement(t,{record:a,resource:o,basePath:r})):null})))},tt=M((function(){return{loader:{width:"100%",backgroundColor:"#e0e0e0",paddingTop:100,paddingBottom:100},image:{width:"100%",maxHeight:"none"}}})),rt=function(t){var r=t.record,n=t.source,a=t.defaultImage,o=we(t,["record","source","defaultImage"]),l=tt();if(r[n]){if(r[n].rawFile instanceof File)return e.createElement(H,{align:"center",className:l.loader},e.createElement(Q,null))}else r[n]=a;return e.createElement(P,Pe({record:r,source:n,classes:{image:l.image}},o))},nt=M((function(){return{root:{flexGrow:1}}})),at=function(t){var r=t.basePath,n=t.children,a=t.record,o=t.resource,l=t.title,i=t.image,c=t.defaultImage,s=nt();return e.createElement("div",{className:s.root},e.createElement(H,null,e.createElement(K,{variant:"h3",color:"primary",paragraph:!0},e.cloneElement(l,{record:a}))),e.createElement(F,{container:!0,spacing:5},e.createElement(F,{item:!0,xs:12,sm:5},e.createElement(rt,{record:a,source:i,defaultImage:c,title:l})),e.createElement(F,{item:!0,xs:12,sm:7},e.createElement(et,{record:a,resource:o,basePath:r},n))))};at.defaultProps={defaultImage:process.env.PUBLIC_URL+"/logo192.png"};var ot=function(t){var r=t.basePath,n=t.className,a=t.data,o=t.hasList,l=t.hasEdit,i=we(t,["basePath","className","data","hasList","hasEdit"]);return e.createElement(c,Pe({className:n},i),o&&e.createElement(s,{basePath:r,record:a}),l&&e.createElement(w,{basePath:r,record:a}))},lt=function(t){return e.createElement(x,Pe({actions:e.createElement(ot,null)},t))},it=M((function(){return{parent:{position:"relative"},child:{position:"absolute",bottom:0,left:0,right:0,paddingTop:2,paddingBottom:2,paddingLeft:6,paddingRight:6},caption:{color:"black",fontSize:13}}})),ct=function(t){var r=t.record,n=it(),a=r?r["pair:firstName"]+" "+r["pair:lastName"]:"";return e.createElement(H,{className:n.parent},e.createElement("img",{src:process.env.PUBLIC_URL+"/unknown-user.png",style:{width:"100%"},alt:a}),e.createElement(H,{bgcolor:"secondary.main",className:n.child,borderRadius:7},e.createElement(K,{align:"center",className:n.caption,noWrap:!0},a)))},st=function(t){var r=t.source,n=t.record;return n&&n[r]?e.createElement(he,{source:n[r]}):null},ut=fe((function(e){return{root:{display:"flex",flexWrap:"wrap"},link:{}}})),mt=function(e){return e.stopPropagation()},dt=function(){},pt=function(e){e.classes;var t=e.className,o=e.children,l=e.linkType,i=void 0===l?"edit":l,c=e.separator,s=void 0===c?",":c,u=we(e,["classes","className","children","linkType","separator"]),m=v(e),d=m.ids,p=m.data,f=m.loaded,h=m.resource,E=m.basePath,b=ut(e);return!1===f?r(X,null):r("div",Pe({className:Ee(b.root,t)},k(u)),d.map((function(e,t){var l=!!i&&y(E,e,i);return l?r("span",{key:e},r(L,{classes:b.link,to:l,onClick:mt},n(a.only(o),{record:p[e],resource:h,basePath:E,onClick:dt})),t<d.length-1&&s+" "):n(a.only(o),{key:e,record:p[e],resource:h,basePath:E})})))},ft=M({root:{display:"flex",alignItems:"center"}}),ht=function(t){var r=t.label,n=t.reference,a=t.source,l=t.children,i=ft(),c=xe(o(!1),2),s=c[0],u=c[1],m=xe(S(n),2),d=m[0],p=m[1].loading,f=N(),h=C(),E=ie(),b=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d({payload:{data:t}},{onSuccess:function(e){var t=e.data;u(!1),E.change(a,t["@id"])},onFailure:function(e){var t=e.error;h(t.message,"error")}});case 1:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){ve(o,n,a,l,i,"next",e)}function i(e){ve(o,n,a,l,i,"throw",e)}l(void 0)}))});return function(e){return t.apply(this,arguments)}}();return e.createElement("div",{className:i.root},e.createElement(I,{label:r,reference:n,source:a},l),e.createElement(B,{onClick:function(){return u(!0)},label:"ra.action.create"},e.createElement(be,null)),e.createElement(Y,{fullWidth:!0,open:s,onClose:function(){return u(!1)}},e.createElement(Z,null,f("ra.action.create")),e.createElement(T,{resource:n,save:b,render:function(t){var r=t.handleSubmitWithRedirect,n=t.pristine,a=t.saving;return e.createElement(e.Fragment,null,e.createElement(ee,null,e.createElement(O,{label:"Titre",source:"pair:label",validate:R(),fullWidth:!0})),e.createElement(te,null,e.createElement(B,{label:"ra.action.cancel",onClick:function(){return u(!1)},disabled:p},e.createElement(ge,null)),e.createElement(W,{handleSubmitWithRedirect:r,pristine:n,saving:a,disabled:p})))}})))};export{Ie as AppBar,$e as Column,Ke as ColumnShowLayout,Fe as Create,We as CreateActions,Ae as Edit,je as EditActions,Ye as GridList,at as Hero,Te as Layout,ze as List,st as MarkdownField,ht as ReferenceQuickCreateInput,Ve as ResourceTabs,pt as SeparatedListField,lt as Show,ot as ShowActions,_e as SimpleList,ct as UserIcon,Re as theme};
